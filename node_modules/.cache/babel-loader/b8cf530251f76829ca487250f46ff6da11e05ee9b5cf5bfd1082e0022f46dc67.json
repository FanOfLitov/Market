{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Documents\\\\GitHub\\\\Market\\\\src\\\\components\\\\Productservice\\\\ProductCard.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport StarRating from '../Shared/StarRating';\nimport { formatPrice } from '../../utils/format';\nimport { getProductRating } from '../../services/reviews';\nimport { addToCart } from '../../services/cart';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { useToast } from '../Shared/ToastProvider';\nimport { getRolesFromToken } from '../../utils/jwt';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PRODUCTS_API = process.env.REACT_APP_PRODUCTS_URL || 'http://localhost:8072/productservice/api/v1';\nconst extractAttachmentIds = p => {\n  if (Array.isArray(p === null || p === void 0 ? void 0 : p.attachments) && p.attachments.length) {\n    return p.attachments.map(a => (a === null || a === void 0 ? void 0 : a.gridFsId) || (a === null || a === void 0 ? void 0 : a.id) || a).filter(Boolean);\n  }\n  if (p !== null && p !== void 0 && p.mainAttachmentId) return [p.mainAttachmentId];\n  return [];\n};\nconst getRatingValue = p => {\n  var _ref, _ref2, _ref3, _p$rating;\n  const v = (_ref = (_ref2 = (_ref3 = (_p$rating = p === null || p === void 0 ? void 0 : p.rating) !== null && _p$rating !== void 0 ? _p$rating : p === null || p === void 0 ? void 0 : p.ratingAverage) !== null && _ref3 !== void 0 ? _ref3 : p === null || p === void 0 ? void 0 : p.avgRating) !== null && _ref2 !== void 0 ? _ref2 : p === null || p === void 0 ? void 0 : p.averageRating) !== null && _ref !== void 0 ? _ref : 0;\n  const n = Number(v);\n  return Number.isFinite(n) ? n : 0;\n};\nconst getRatingCount = p => {\n  var _ref4, _ref5, _ref6, _p$ratingCount;\n  const c = (_ref4 = (_ref5 = (_ref6 = (_p$ratingCount = p === null || p === void 0 ? void 0 : p.ratingCount) !== null && _p$ratingCount !== void 0 ? _p$ratingCount : p === null || p === void 0 ? void 0 : p.reviewsCount) !== null && _ref6 !== void 0 ? _ref6 : p === null || p === void 0 ? void 0 : p.reviewCount) !== null && _ref5 !== void 0 ? _ref5 : p === null || p === void 0 ? void 0 : p.ratingsCount) !== null && _ref4 !== void 0 ? _ref4 : 0;\n  const n = Number(c);\n  return Number.isFinite(n) ? n : 0;\n};\nconst useInViewportOnce = (threshold = 0.2) => {\n  _s();\n  const ref = useRef(null);\n  const [visible, setVisible] = useState(false);\n  useEffect(() => {\n    const el = ref.current;\n    if (!el || visible) return;\n    const obs = new IntersectionObserver(([entry]) => {\n      if (entry.isIntersecting) {\n        setVisible(true);\n        obs.disconnect();\n      }\n    }, {\n      threshold\n    });\n    obs.observe(el);\n    return () => obs.disconnect();\n  }, [visible]);\n  return [ref, visible];\n};\n_s(useInViewportOnce, \"F7BtIAxVh3vOWU1Jr24RYsj9CHc=\");\nconst ProductCard = ({\n  product,\n  canManage,\n  onEdit,\n  showBuy = true,\n  showUpload = false,\n  onUpload,\n  onRequireAuth,\n  onSetMainAttachment,\n  onDeleteAttachment,\n  stockInfo,\n  onOpenStock\n}) => {\n  _s2();\n  const requireAuth = typeof onRequireAuth === 'function' ? onRequireAuth : () => alert('Нужно войти');\n\n  // --- rating из товара как базовый (fallback) ---\n  const initialAvg = getRatingValue(product);\n  const initialCnt = getRatingCount(product);\n  const [avg, setAvg] = useState(initialAvg);\n  const [count, setCount] = useState(initialCnt);\n  const [ratingLoading, setRatingLoading] = useState(false);\n  const [ratingError, setRatingError] = useState('');\n  const token = useMemo(() => localStorage.getItem('jwtToken'), []);\n  const roles = useMemo(() => token ? getRolesFromToken(token) : [], [token]);\n  const isUser = roles.includes('USER') || roles.includes('ROLE_USER');\n  const productId = useMemo(() => product.productUUID || product.id, [product]);\n  const navigate = useNavigate();\n  const openDetails = e => {\n    if (e.target.closest('[data-role=\"gallery-control\"]')) return;\n    if (!productId) return;\n    navigate(`/product/${productId}`);\n  };\n\n  // --- images logic ---\n  const initialIds = useMemo(() => extractAttachmentIds(product), [product]);\n  const [attachmentIds, setAttachmentIds] = useState(initialIds);\n  const [fetchedAll, setFetchedAll] = useState(Array.isArray(product === null || product === void 0 ? void 0 : product.attachments) && product.attachments.length > 0);\n  const [currentIdx, setCurrentIdx] = useState(0);\n  const [hostRef, inView] = useInViewportOnce(0.2);\n  const imageId = attachmentIds[currentIdx];\n  const imgSrc = inView && imageId ? `${PRODUCTS_API}/products/${imageId}/attachments-fs` : null;\n  const fetchAllIds = useCallback(async () => {\n    if (fetchedAll || !productId) return false;\n    try {\n      const res = await fetch(`${PRODUCTS_API}/products/${productId}/attachments`);\n      if (!res.ok) return false;\n      const list = await res.json();\n      const ids = Array.isArray(list) ? list.map(a => (a === null || a === void 0 ? void 0 : a.gridFsId) || (a === null || a === void 0 ? void 0 : a.id)).filter(Boolean) : [];\n      if (ids.length) {\n        setAttachmentIds(ids);\n        setFetchedAll(true);\n        setCurrentIdx(i => Math.min(i, ids.length - 1));\n        return true;\n      }\n    } catch {}\n    return false;\n  }, [fetchedAll, productId]);\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      if (!inView) return;\n      if (attachmentIds.length > 0) return;\n      const ok = await fetchAllIds();\n      if (!cancelled && !ok) {\n        // оставим плейсхолдер\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, [inView, attachmentIds.length, fetchAllIds]);\n  const goPrev = useCallback(async e => {\n    var _e$stopPropagation;\n    e === null || e === void 0 ? void 0 : (_e$stopPropagation = e.stopPropagation) === null || _e$stopPropagation === void 0 ? void 0 : _e$stopPropagation.call(e);\n    if (!fetchedAll && attachmentIds.length <= 1) {\n      const ok = await fetchAllIds();\n      if (!ok || attachmentIds.length <= 1) return;\n    }\n    setCurrentIdx(i => (i - 1 + attachmentIds.length) % attachmentIds.length);\n  }, [fetchedAll, attachmentIds.length, fetchAllIds]);\n  const goNext = useCallback(async e => {\n    var _e$stopPropagation2;\n    e === null || e === void 0 ? void 0 : (_e$stopPropagation2 = e.stopPropagation) === null || _e$stopPropagation2 === void 0 ? void 0 : _e$stopPropagation2.call(e);\n    if (!fetchedAll && attachmentIds.length <= 1) {\n      const ok = await fetchAllIds();\n      if (!ok || attachmentIds.length <= 1) return;\n    }\n    setCurrentIdx(i => (i + 1) % attachmentIds.length);\n  }, [fetchedAll, attachmentIds.length, fetchAllIds]);\n  const hasCarousel = attachmentIds.length > 1;\n  const uploadInputId = `upload-${productId}`;\n  const handleFileChange = e => {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (file && onUpload) onUpload(product, file);\n    e.target.value = '';\n  };\n  const toast = useToast();\n  const handleAddToCart = async () => {\n    const token = localStorage.getItem('jwtToken');\n    if (!token) {\n      requireAuth();\n      return;\n    }\n    try {\n      await addToCart(productId, 1);\n      toast.success('Добавлено в корзину');\n    } catch (e) {\n      toast.error(e.message || 'Не удалось добавить в корзину');\n    }\n  };\n  const handleSetMain = async () => {\n    if (!imageId || !onSetMainAttachment) return;\n    try {\n      await onSetMainAttachment(product, imageId);\n      setAttachmentIds(prev => [imageId, ...prev.filter(id => id !== imageId)]);\n      setCurrentIdx(0);\n    } catch {}\n  };\n  const handleDelete = async () => {\n    if (!imageId || !onDeleteAttachment) return;\n    try {\n      await onDeleteAttachment(product, imageId);\n      setAttachmentIds(prev => prev.filter(id => id !== imageId));\n      setCurrentIdx(i => Math.max(0, Math.min(i, attachmentIds.length - 2)));\n    } catch {}\n  };\n\n  // ===================== REVIEWS: загрузка рейтинга ======================\n  const [ratingLoadedOnce, setRatingLoadedOnce] = useState(false);\n  const loadRating = useCallback(async () => {\n    if (!productId) return;\n    try {\n      var _ref7, _r$avg, _ref8, _r$cnt;\n      setRatingLoading(true);\n      setRatingError('');\n      const r = await getProductRating(productId);\n      const newAvg = Number((_ref7 = (_r$avg = r === null || r === void 0 ? void 0 : r.avg) !== null && _r$avg !== void 0 ? _r$avg : r === null || r === void 0 ? void 0 : r.average) !== null && _ref7 !== void 0 ? _ref7 : 0);\n      const newCnt = Number((_ref8 = (_r$cnt = r === null || r === void 0 ? void 0 : r.cnt) !== null && _r$cnt !== void 0 ? _r$cnt : r === null || r === void 0 ? void 0 : r.count) !== null && _ref8 !== void 0 ? _ref8 : 0);\n      if (Number.isFinite(newAvg)) setAvg(newAvg);\n      if (Number.isFinite(newCnt)) setCount(newCnt);\n      setRatingLoadedOnce(true);\n    } catch {\n      setRatingError('Не удалось получить рейтинг');\n    } finally {\n      setRatingLoading(false);\n    }\n  }, [productId]);\n  useEffect(() => {\n    if (inView && !ratingLoadedOnce) {\n      loadRating();\n    }\n  }, [inView, ratingLoadedOnce, loadRating]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: hostRef,\n    className: \"bg-white rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 overflow-hidden group\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative aspect-square overflow-hidden bg-gray-200\",\n      onClick: openDetails,\n      style: {\n        cursor: 'pointer'\n      },\n      children: [imgSrc ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: imgSrc,\n          alt: product.title,\n          className: \"w-full h-full object-cover select-none\",\n          draggable: false,\n          loading: \"lazy\",\n          onError: e => {\n            e.currentTarget.src = '';\n            e.currentTarget.alt = 'Изображение недоступно';\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 25\n        }, this), hasCarousel && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            \"data-role\": \"gallery-control\",\n            onClick: goPrev,\n            className: \"absolute top-0 left-0 h-full w-1/3 z-10 cursor-pointer hover:bg-black/5 active:bg-black/10 transition-colors\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            \"data-role\": \"gallery-control\",\n            onClick: goNext,\n            className: \"absolute top-0 right-0 h-full w-1/3 z-10 cursor-pointer hover:bg-black/5 active:bg-black/10 transition-colors\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            \"data-role\": \"gallery-control\",\n            onClick: goPrev,\n            className: \"absolute top-1/2 -translate-y-1/2 left-2 opacity-0 group-hover:opacity-100 transition-opacity z-20 bg-white/80 rounded-full p-2 shadow\",\n            \"aria-label\": \"\\u041D\\u0430\\u0437\\u0430\\u0434\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-5 h-5 text-gray-800\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M15 19l-7-7 7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 130\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            \"data-role\": \"gallery-control\",\n            onClick: goNext,\n            className: \"absolute top-1/2 -translate-y-1/2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20 bg-white/80 rounded-full p-2 shadow\",\n            \"aria-label\": \"\\u0412\\u043F\\u0435\\u0440\\u0451\\u0434\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-5 h-5 text-gray-800\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M9 5l7 7-7 7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 130\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute bottom-2 left-0 right-0 flex justify-center gap-1.5 z-20\",\n            children: attachmentIds.map((_, i) => /*#__PURE__*/_jsxDEV(\"span\", {\n              \"data-role\": \"gallery-control\",\n              onClick: e => {\n                e.stopPropagation();\n                setCurrentIdx(i);\n              },\n              className: `h-1.5 rounded-full cursor-pointer transition-all ${i === currentIdx ? 'w-4 bg-white' : 'w-2 bg-white/60 hover:bg-white/80'}`\n            }, i, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 41\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true), showUpload && imageId && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute top-2 right-2 z-30 flex gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: handleSetMain,\n            title: \"\\u0421\\u0434\\u0435\\u043B\\u0430\\u0442\\u044C \\u043F\\u0440\\u0435\\u0432\\u044C\\u044E\",\n            className: \"bg-white/90 hover:bg-white text-yellow-600 rounded-full p-2 shadow\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-5 h-5\",\n              fill: \"currentColor\",\n              viewBox: \"0 0 20 20\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81\\u043B-2.8 2.034...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 102\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: handleDelete,\n            title: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0444\\u043E\\u0442\\u043E\",\n            className: \"bg-white/90 hover:bg-white text-red-600 rounded-full p-2 shadow\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-5 h-5\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M19 7\\u043B-...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 252,\n                columnNumber: 116\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full h-full flex items-center justify-center\",\n        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-16 h-16 text-gray-400\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 2,\n            d: \"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 21\n      }, this), product.stock <= 5 && product.stock > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-2 left-2 bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-medium z-30\",\n        children: [\"\\u041E\\u0441\\u0442\\u0430\\u043B\\u043E\\u0441\\u044C \", product.stock]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 21\n      }, this), product.stock === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 bg-black/50 flex items-center justify-center z-30\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-white font-medium\",\n          children: \"\\u041D\\u0435\\u0442 \\u0432 \\u043D\\u0430\\u043B\\u0438\\u0447\\u0438\\u0438\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start justify-between mb-2\",\n        children: /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"font-semibold text-gray-900 text-sm leading-tight line-clamp-2\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: `/product/${productId}`,\n            className: \"hover:underline\",\n            children: product.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600 text-sm mb-3 line-clamp-2\",\n        children: product.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center mb-3\",\n        children: [/*#__PURE__*/_jsxDEV(StarRating, {\n          rating: avg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 21\n        }, this), ratingLoading && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-xs text-gray-400 ml-2\",\n          children: \"\\u043E\\u0431\\u043D\\u043E\\u0432\\u043B\\u044F\\u0435\\u043C\\u2026\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 39\n        }, this), !ratingLoading && avg > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-700 ml-2\",\n            children: avg.toFixed(1)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 29\n          }, this), count > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-500 ml-1\",\n            children: [\"(\", count, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true) : !ratingLoading && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-sm text-gray-400 ml-2\",\n          children: \"\\u041D\\u0435\\u0442 \\u043E\\u0442\\u0437\\u044B\\u0432\\u043E\\u0432\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 44\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `flex items-center ${showBuy ? 'justify-between' : 'justify-start'}`,\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-xl font-bold text-gray-900\",\n          children: formatPrice(product.price)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 21\n        }, this), showBuy && isUser && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleAddToCart,\n          className: \"px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 text-white\",\n          children: \"\\u0412 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0443\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2 mt-2\",\n        children: [canManage && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => onEdit && onEdit(product),\n          className: \"px-4 py-2 rounded-lg text-sm font-medium bg-green-600 hover:bg-green-700 text-white\",\n          children: \"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 25\n        }, this), canManage && onOpenStock && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => onOpenStock(product),\n          className: \"px-4 py-2 rounded-lg text-sm font-medium bg-indigo-600 hover:bg-indigo-700 text-white\",\n          children: \"\\u0421\\u043A\\u043B\\u0430\\u0434\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 25\n        }, this), showUpload && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            id: uploadInputId,\n            type: \"file\",\n            accept: \"image/*\",\n            className: \"hidden\",\n            onChange: handleFileChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: uploadInputId,\n            className: \"cursor-pointer px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-800\",\n            children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0444\\u043E\\u0442\\u043E\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true), canManage && stockInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-1 text-xs text-gray-600\",\n          children: [\"\\u041D\\u0430 \\u0441\\u043A\\u043B\\u0430\\u0434\\u0435: \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-medium\",\n            children: stockInfo.available\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 40\n          }, this), typeof stockInfo.quantityReserved === 'number' && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"ml-2 text-gray-500\",\n            children: [\"\\u0440\\u0435\\u0437\\u0435\\u0440\\u0432: \", stockInfo.quantityReserved]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 217,\n    columnNumber: 9\n  }, this);\n};\n_s2(ProductCard, \"WmuTh1oeACthdQyPICk58VLK+7w=\", false, function () {\n  return [useNavigate, useInViewportOnce, useToast];\n});\n_c = ProductCard;\nexport default ProductCard;\nvar _c;\n$RefreshReg$(_c, \"ProductCard\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","StarRating","formatPrice","getProductRating","addToCart","useNavigate","Link","useToast","getRolesFromToken","jsxDEV","_jsxDEV","Fragment","_Fragment","PRODUCTS_API","process","env","REACT_APP_PRODUCTS_URL","extractAttachmentIds","p","Array","isArray","attachments","length","map","a","gridFsId","id","filter","Boolean","mainAttachmentId","getRatingValue","_ref","_ref2","_ref3","_p$rating","v","rating","ratingAverage","avgRating","averageRating","n","Number","isFinite","getRatingCount","_ref4","_ref5","_ref6","_p$ratingCount","c","ratingCount","reviewsCount","reviewCount","ratingsCount","useInViewportOnce","threshold","_s","ref","visible","setVisible","el","current","obs","IntersectionObserver","entry","isIntersecting","disconnect","observe","ProductCard","product","canManage","onEdit","showBuy","showUpload","onUpload","onRequireAuth","onSetMainAttachment","onDeleteAttachment","stockInfo","onOpenStock","_s2","requireAuth","alert","initialAvg","initialCnt","avg","setAvg","count","setCount","ratingLoading","setRatingLoading","ratingError","setRatingError","token","localStorage","getItem","roles","isUser","includes","productId","productUUID","navigate","openDetails","e","target","closest","initialIds","attachmentIds","setAttachmentIds","fetchedAll","setFetchedAll","currentIdx","setCurrentIdx","hostRef","inView","imageId","imgSrc","fetchAllIds","res","fetch","ok","list","json","ids","i","Math","min","cancelled","goPrev","_e$stopPropagation","stopPropagation","call","goNext","_e$stopPropagation2","hasCarousel","uploadInputId","handleFileChange","_e$target$files","file","files","value","toast","handleAddToCart","success","error","message","handleSetMain","prev","handleDelete","max","ratingLoadedOnce","setRatingLoadedOnce","loadRating","_ref7","_r$avg","_ref8","_r$cnt","r","newAvg","average","newCnt","cnt","className","children","onClick","style","cursor","src","alt","title","draggable","loading","onError","currentTarget","fileName","_jsxFileName","lineNumber","columnNumber","type","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","_","stock","to","description","toFixed","price","accept","onChange","htmlFor","available","quantityReserved","_c","$RefreshReg$"],"sources":["C:/Users/User/Documents/GitHub/Market/src/components/Productservice/ProductCard.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport StarRating from '../Shared/StarRating';\r\nimport { formatPrice } from '../../utils/format';\r\nimport { getProductRating } from '../../services/reviews';\r\nimport { addToCart } from '../../services/cart';\r\nimport { useNavigate, Link } from 'react-router-dom';\r\nimport { useToast } from '../Shared/ToastProvider';\r\nimport { getRolesFromToken } from '../../utils/jwt';\r\n\r\nconst PRODUCTS_API =\r\n    process.env.REACT_APP_PRODUCTS_URL ||\r\n    'http://localhost:8072/productservice/api/v1';\r\n\r\nconst extractAttachmentIds = (p) => {\r\n    if (Array.isArray(p?.attachments) && p.attachments.length) {\r\n        return p.attachments.map((a) => a?.gridFsId || a?.id || a).filter(Boolean);\r\n    }\r\n    if (p?.mainAttachmentId) return [p.mainAttachmentId];\r\n    return [];\r\n};\r\n\r\nconst getRatingValue = (p) => {\r\n    const v = p?.rating ?? p?.ratingAverage ?? p?.avgRating ?? p?.averageRating ?? 0;\r\n    const n = Number(v);\r\n    return Number.isFinite(n) ? n : 0;\r\n};\r\nconst getRatingCount = (p) => {\r\n    const c = p?.ratingCount ?? p?.reviewsCount ?? p?.reviewCount ?? p?.ratingsCount ?? 0;\r\n    const n = Number(c);\r\n    return Number.isFinite(n) ? n : 0;\r\n};\r\n\r\nconst useInViewportOnce = (threshold = 0.2) => {\r\n    const ref = useRef(null);\r\n    const [visible, setVisible] = useState(false);\r\n    useEffect(() => {\r\n        const el = ref.current;\r\n        if (!el || visible) return;\r\n        const obs = new IntersectionObserver(\r\n            ([entry]) => {\r\n                if (entry.isIntersecting) {\r\n                    setVisible(true);\r\n                    obs.disconnect();\r\n                }\r\n            },\r\n            { threshold }\r\n        );\r\n        obs.observe(el);\r\n        return () => obs.disconnect();\r\n    }, [visible]);\r\n    return [ref, visible];\r\n};\r\n\r\nconst ProductCard = ({\r\n                         product,\r\n                         canManage,\r\n                         onEdit,\r\n                         showBuy = true,\r\n                         showUpload = false,\r\n                         onUpload,\r\n                         onRequireAuth,\r\n                         onSetMainAttachment,\r\n                         onDeleteAttachment,\r\n                         stockInfo,\r\n                         onOpenStock\r\n}) => {\r\n    const requireAuth = typeof onRequireAuth === 'function' ? onRequireAuth : () => alert('Нужно войти');\r\n\r\n    // --- rating из товара как базовый (fallback) ---\r\n    const initialAvg = getRatingValue(product);\r\n    const initialCnt = getRatingCount(product);\r\n\r\n    const [avg, setAvg] = useState(initialAvg);\r\n    const [count, setCount] = useState(initialCnt);\r\n    const [ratingLoading, setRatingLoading] = useState(false);\r\n    const [ratingError, setRatingError] = useState('');\r\n\r\n    const token = useMemo(() => localStorage.getItem('jwtToken'), []);\r\n    const roles = useMemo(() => (token ? getRolesFromToken(token) : []), [token]);\r\n    const isUser = roles.includes('USER') || roles.includes('ROLE_USER');\r\n\r\n\r\n    const productId = useMemo(() => product.productUUID || product.id, [product]);\r\n    const navigate = useNavigate();\r\n    const openDetails = (e) => {\r\n        if (e.target.closest('[data-role=\"gallery-control\"]')) return;\r\n        if (!productId) return;\r\n        navigate(`/product/${productId}`);\r\n    };\r\n\r\n    // --- images logic ---\r\n    const initialIds = useMemo(() => extractAttachmentIds(product), [product]);\r\n    const [attachmentIds, setAttachmentIds] = useState(initialIds);\r\n    const [fetchedAll, setFetchedAll] = useState(Array.isArray(product?.attachments) && product.attachments.length > 0);\r\n    const [currentIdx, setCurrentIdx] = useState(0);\r\n\r\n    const [hostRef, inView] = useInViewportOnce(0.2);\r\n    const imageId = attachmentIds[currentIdx];\r\n    const imgSrc = inView && imageId ? `${PRODUCTS_API}/products/${imageId}/attachments-fs` : null;\r\n\r\n    const fetchAllIds = useCallback(async () => {\r\n        if (fetchedAll || !productId) return false;\r\n        try {\r\n            const res = await fetch(`${PRODUCTS_API}/products/${productId}/attachments`);\r\n            if (!res.ok) return false;\r\n            const list = await res.json();\r\n            const ids = Array.isArray(list) ? list.map(a => a?.gridFsId || a?.id).filter(Boolean) : [];\r\n            if (ids.length) {\r\n                setAttachmentIds(ids);\r\n                setFetchedAll(true);\r\n                setCurrentIdx(i => Math.min(i, ids.length - 1));\r\n                return true;\r\n            }\r\n        } catch {}\r\n        return false;\r\n    }, [fetchedAll, productId]);\r\n\r\n    useEffect(() => {\r\n        let cancelled = false;\r\n        (async () => {\r\n            if (!inView) return;\r\n            if (attachmentIds.length > 0) return;\r\n            const ok = await fetchAllIds();\r\n            if (!cancelled && !ok) {\r\n                // оставим плейсхолдер\r\n            }\r\n        })();\r\n        return () => { cancelled = true; };\r\n    }, [inView, attachmentIds.length, fetchAllIds]);\r\n\r\n    const goPrev = useCallback(async (e) => {\r\n        e?.stopPropagation?.();\r\n        if (!fetchedAll && attachmentIds.length <= 1) {\r\n            const ok = await fetchAllIds();\r\n            if (!ok || attachmentIds.length <= 1) return;\r\n        }\r\n        setCurrentIdx(i => (i - 1 + attachmentIds.length) % attachmentIds.length);\r\n    }, [fetchedAll, attachmentIds.length, fetchAllIds]);\r\n\r\n    const goNext = useCallback(async (e) => {\r\n        e?.stopPropagation?.();\r\n        if (!fetchedAll && attachmentIds.length <= 1) {\r\n            const ok = await fetchAllIds();\r\n            if (!ok || attachmentIds.length <= 1) return;\r\n        }\r\n        setCurrentIdx(i => (i + 1) % attachmentIds.length);\r\n    }, [fetchedAll, attachmentIds.length, fetchAllIds]);\r\n\r\n    const hasCarousel = attachmentIds.length > 1;\r\n\r\n    const uploadInputId = `upload-${productId}`;\r\n    const handleFileChange = (e) => {\r\n        const file = e.target.files?.[0];\r\n        if (file && onUpload) onUpload(product, file);\r\n        e.target.value = '';\r\n    };\r\n\r\n    const toast = useToast();\r\n\r\n    const handleAddToCart = async () => {\r\n        const token = localStorage.getItem('jwtToken');\r\n        if (!token) { requireAuth(); return; }\r\n        try {\r\n            await addToCart(productId, 1);\r\n            toast.success('Добавлено в корзину');\r\n        } catch (e) {\r\n            toast.error(e.message || 'Не удалось добавить в корзину');\r\n        }\r\n    };\r\n\r\n    const handleSetMain = async () => {\r\n        if (!imageId || !onSetMainAttachment) return;\r\n        try {\r\n            await onSetMainAttachment(product, imageId);\r\n            setAttachmentIds(prev => [imageId, ...prev.filter(id => id !== imageId)]);\r\n            setCurrentIdx(0);\r\n        } catch {}\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!imageId || !onDeleteAttachment) return;\r\n        try {\r\n            await onDeleteAttachment(product, imageId);\r\n            setAttachmentIds(prev => prev.filter(id => id !== imageId));\r\n            setCurrentIdx(i => Math.max(0, Math.min(i, attachmentIds.length - 2)));\r\n        } catch {}\r\n    };\r\n\r\n    // ===================== REVIEWS: загрузка рейтинга ======================\r\n    const [ratingLoadedOnce, setRatingLoadedOnce] = useState(false);\r\n\r\n    const loadRating = useCallback(async () => {\r\n        if (!productId) return;\r\n        try {\r\n            setRatingLoading(true);\r\n            setRatingError('');\r\n            const r = await getProductRating(productId);\r\n            const newAvg = Number(r?.avg ?? r?.average ?? 0);\r\n            const newCnt = Number(r?.cnt ?? r?.count ?? 0);\r\n            if (Number.isFinite(newAvg)) setAvg(newAvg);\r\n            if (Number.isFinite(newCnt)) setCount(newCnt);\r\n            setRatingLoadedOnce(true);\r\n        } catch {\r\n            setRatingError('Не удалось получить рейтинг');\r\n        } finally {\r\n            setRatingLoading(false);\r\n        }\r\n    }, [productId]);\r\n\r\n    useEffect(() => {\r\n        if (inView && !ratingLoadedOnce) {\r\n            loadRating();\r\n        }\r\n    }, [inView, ratingLoadedOnce, loadRating]);\r\n\r\n    return (\r\n        <div ref={hostRef} className=\"bg-white rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 overflow-hidden group\">\r\n            <div className=\"relative aspect-square overflow-hidden bg-gray-200\" onClick={openDetails} style={{ cursor: 'pointer' }}>\r\n                {imgSrc ? (\r\n                    <>\r\n                        <img\r\n                            src={imgSrc}\r\n                            alt={product.title}\r\n                            className=\"w-full h-full object-cover select-none\"\r\n                            draggable={false}\r\n                            loading=\"lazy\"\r\n                            onError={(e) => { e.currentTarget.src = ''; e.currentTarget.alt = 'Изображение недоступно'; }}\r\n                        />\r\n                        {hasCarousel && (\r\n                            <>\r\n                                <div data-role=\"gallery-control\" onClick={goPrev} className=\"absolute top-0 left-0 h-full w-1/3 z-10 cursor-pointer hover:bg-black/5 active:bg-black/10 transition-colors\" />\r\n                                <div data-role=\"gallery-control\" onClick={goNext} className=\"absolute top-0 right-0 h-full w-1/3 z-10 cursor-pointer hover:bg-black/5 active:bg-black/10 transition-colors\" />\r\n                                <button type=\"button\" data-role=\"gallery-control\" onClick={goPrev} className=\"absolute top-1/2 -translate-y-1/2 left-2 opacity-0 group-hover:opacity-100 transition-opacity z-20 bg-white/80 rounded-full p-2 shadow\" aria-label=\"Назад\">\r\n                                    <svg className=\"w-5 h-5 text-gray-800\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" /></svg>\r\n                                </button>\r\n                                <button type=\"button\" data-role=\"gallery-control\" onClick={goNext} className=\"absolute top-1/2 -translate-y-1/2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20 bg-white/80 rounded-full p-2 shadow\" aria-label=\"Вперёд\">\r\n                                    <svg className=\"w-5 h-5 text-gray-800\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" /></svg>\r\n                                </button>\r\n                                <div className=\"absolute bottom-2 left-0 right-0 flex justify-center gap-1.5 z-20\">\r\n                                    {attachmentIds.map((_, i) => (\r\n                                        <span key={i} data-role=\"gallery-control\" onClick={(e) => { e.stopPropagation(); setCurrentIdx(i); }} className={`h-1.5 rounded-full cursor-pointer transition-all ${i === currentIdx ? 'w-4 bg-white' : 'w-2 bg-white/60 hover:bg-white/80'}`} />\r\n                                    ))}\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                        {showUpload && imageId && (\r\n                            <div className=\"absolute top-2 right-2 z-30 flex gap-2\">\r\n                                <button type=\"button\" onClick={handleSetMain} title=\"Сделать превью\" className=\"bg-white/90 hover:bg-white text-yellow-600 rounded-full p-2 shadow\">\r\n                                    <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81л-2.8 2.034...\" /></svg>\r\n                                </button>\r\n                                <button type=\"button\" onClick={handleDelete} title=\"Удалить фото\" className=\"bg-white/90 hover:bg-white text-red-600 rounded-full p-2 shadow\">\r\n                                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7л-...\" /></svg>\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                ) : (\r\n                    <div className=\"w-full h-full flex items-center justify-center\">\r\n                        <svg className=\"w-16 h-16 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\r\n                        </svg>\r\n                    </div>\r\n                )}\r\n\r\n                {product.stock <= 5 && product.stock > 0 && (\r\n                    <div className=\"absolute top-2 left-2 bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-medium z-30\">\r\n                        Осталось {product.stock}\r\n                    </div>\r\n                )}\r\n                {product.stock === 0 && (\r\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center z-30\">\r\n                        <span className=\"text-white font-medium\">Нет в наличии</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n                <div className=\"flex items-start justify-between mb-2\">\r\n                    <h3 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2\">\r\n                        <Link to={`/product/${productId}`} className=\"hover:underline\">{product.title}</Link>\r\n                    </h3>\r\n                </div>\r\n\r\n                <p className=\"text-gray-600 text-sm mb-3 line-clamp-2\">{product.description}</p>\r\n\r\n                <div className=\"flex items-center mb-3\">\r\n                    <StarRating rating={avg} />\r\n                    {ratingLoading && <span className=\"text-xs text-gray-400 ml-2\">обновляем…</span>}\r\n                    {!ratingLoading && avg > 0 ? (\r\n                        <>\r\n                            <span className=\"text-sm text-gray-700 ml-2\">{avg.toFixed(1)}</span>\r\n                            {count > 0 && <span className=\"text-sm text-gray-500 ml-1\">({count})</span>}\r\n                        </>\r\n                    ) : (!ratingLoading && <span className=\"text-sm text-gray-400 ml-2\">Нет отзывов</span>)}\r\n                </div>\r\n\r\n                <div className={`flex items-center ${showBuy ? 'justify-between' : 'justify-start'}`}>\r\n                    <span className=\"text-xl font-bold text-gray-900\">{formatPrice(product.price)}</span>\r\n                    {showBuy && isUser && (\r\n                        <button onClick={handleAddToCart} className=\"px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 text-white\">\r\n                            В корзину\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2 mt-2\">\r\n                    {canManage && (\r\n                        <button onClick={() => onEdit && onEdit(product)} className=\"px-4 py-2 rounded-lg text-sm font-medium bg-green-600 hover:bg-green-700 text-white\">\r\n                            Редактировать\r\n                        </button>\r\n                    )}\r\n                    {canManage && onOpenStock && (\r\n                        <button onClick={() => onOpenStock(product)} className=\"px-4 py-2 rounded-lg text-sm font-medium bg-indigo-600 hover:bg-indigo-700 text-white\">\r\n                            Склад\r\n                        </button>\r\n                    )}\r\n                    {showUpload && (\r\n                        <>\r\n                            <input id={uploadInputId} type=\"file\" accept=\"image/*\" className=\"hidden\" onChange={handleFileChange} />\r\n                            <label htmlFor={uploadInputId} className=\"cursor-pointer px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-800\">\r\n                                Загрузить фото\r\n                            </label>\r\n                        </>\r\n                    )}\r\n                    {canManage && stockInfo && (\r\n                        <div className=\"mt-1 text-xs text-gray-600\">\r\n                            На складе: <span className=\"font-medium\">{stockInfo.available}</span>\r\n                            {typeof stockInfo.quantityReserved === 'number' && (\r\n                            <span className=\"ml-2 text-gray-500\">резерв: {stockInfo.quantityReserved}</span>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ProductCard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}